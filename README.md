# 海小棠桌面宠物 (HaiXiaoTang)

> **基于本地 LLM 驱动的轻量化智能桌面宠物**

一个可爱的桌面伙伴，能够通过本地大模型与你进行自然语言交流。本项目采用**脚本化启动 + 嵌入式 Python 环境**方案，摒弃了臃肿的打包方式，保持项目轻量且易于修改。

---

##  基本功能

- **本地 LLM 对话**：基于 `llama.cpp`，支持 GGUF 格式模型，完全本地运行，保护隐私，断网可用。
- **桌面互动**：
  - **拖拽移动**：按住鼠标左键可拖动宠物到屏幕任意位置。
  - **点击对话**：左键点击宠物即可触发对话。
  - **右键菜单**：提供“设置”、“隐藏”、“退出”等快捷操作。
- **角色定制**：通过修改 `character.txt` 即可自定义宠物的性格、语气和背景设定。
- **参数调整**：内置设置界面，可实时调整模型参数（温度、上下文长度等）及系统提示词。
- **轻量化运行**：
  - 采用嵌入式 Python 环境，无需安装庞大的 Anaconda 或系统 Python。
  - 经过深度精简的依赖库 (去除 PySide6 无用组件)，Runtime 仅约 460MB。
  - 极低的内存占用（取决于选用的模型大小）。

##  快速启动 (推荐)

本项目内置了轻量级的 Python 运行环境管理脚本，无需手动安装复杂的开发环境。

### 1. 准备模型
确保你已经下载了 GGUF 格式的大语言模型（例如 `qwen1_5-0_5b-chat-q4_k_m.gguf`），并将其放置在 **`modle/`** 文件夹下。

### 2. 初始化环境 (首次运行)
双击运行根目录下的 **`setup_env.bat`**。
- 该脚本会自动下载轻量级 Python 嵌入包。
- 自动安装项目所需的最小依赖 (PySide6, llama-cpp-python 等)。
- **注意**：如果不运行此步骤，启动脚本也能尝试通过系统 Python 运行，但推荐使用独立环境以避免冲突。

### 3. 启动宠物
双击运行 **`Start_Pet.bat`** 即可呼唤海小棠！
- 程序会在系统托盘运行，右键托盘图标可退出。
- 首次运行时会自动在 `modle/` 目录下生成配置文件。

---

##  项目结构

| 目录/文件 | 说明 |
| :--- | :--- |
| **`Start_Pet.bat`** | **启动入口**。优先使用 `runtime/` 环境，无黑框运行。 |
| **`setup_env.bat`** | **环境安装脚本**。一键通过 `install_env.ps1` 构建 `runtime`。 |
| `src/` | 核心源代码 (`main.py`, `pet_ui.py`, `llm_client.py` 等)。 |
| `modle/` | 放置 `.gguf` 模型文件。首次运行通过 `config.json` 配置模型路径。 |
| `runtime/` | ((自动生成)) 嵌入式 Python 环境，体积已精简 (剔除无用组件)。 |
| `image/` | 宠物动作图片素材。 |
| `character.txt` | 角色设定提示词，可自由修改以定制性格。 |
| `requirements.txt` | Python 依赖列表。 |

---

##  配置说明

### 修改模型配置
在 `modle/config.json` 中修改：
```json
{
    "model_path": "modle/你的模型文件名.gguf",
    "context_window": 2048,
    "max_tokens": 1024,
    "temperature": 0.7
}
```

### 修改角色设定
直接编辑根目录下的 **`character.txt`** 文件，输入你想要的角色设定Prompt。

---

##  开发者指南 (手动模式)

如果你希望使用自己的 Python 环境进行开发：

1. 克隆项目或下载源码。
2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
3. 运行：
   ```bash
   python src/main.py
   ```


